<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>StudyBuddy â€” Ù…Ù„Ø§Ø²Ù…ØŒ Ù…Ø¤Ù‚Øª ÙˆÙ…Ù„Ø§Ø­Ø¸Ø§Øª</title>

  <style>
    /* ===== Ø¹Ø§Ù… ===== */
    :root{ --primary:#0b6e4f; --muted:#707070; --bg:#f6f6f6; --card:#fff; --fast:120ms; }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:Tahoma,Arial,sans-serif;background:var(--bg);color:#222;direction:rtl;scroll-behavior:smooth}
    a{color:var(--primary);text-decoration:none}
    a:hover{text-decoration:underline}

    /* ===== Ø´Ø±ÙŠØ· Ø¹Ù„ÙˆÙŠ ===== */
    .topbar{display:flex;align-items:center;justify-content:space-between;background:var(--primary);color:#fff;padding:12px 14px;position:sticky;top:0;z-index:80}
    .brand{font-weight:700;font-size:18px}
    .icon-btn{background:none;border:0;color:#fff;font-size:20px;cursor:pointer;padding:6px}

    /* ===== ØªØ®Ø·ÙŠØ· Ø§Ù„ØµÙØ­Ø© ===== */
    .layout{display:flex;min-height:calc(100vh - 56px)}
    /* Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© */
    .side{width:260px;background:var(--card);border-left:1px solid #e6e6e6;padding:12px;box-shadow:-6px 0 18px rgba(0,0,0,0.04);transition:transform var(--fast) ease;transform:translateX(0)}
    .side.hidden{transform:translateX(110%)}
    .side ul{list-style:none;padding:0;margin:0}
    .side li{padding:10px;border-radius:8px;cursor:pointer;margin-bottom:6px}
    .side li.active,.side li:hover{background:var(--primary);color:#fff}
    .side .small{font-size:12px;color:var(--muted);text-align:center;margin-top:8px}

    /* Ø§Ù„Ù…Ø­ØªÙˆÙ‰ */
    main{flex:1;padding:16px;max-width:1100px;margin:0 auto}
    .card{background:var(--card);border-radius:10px;padding:16px;margin-bottom:14px;box-shadow:0 2px 8px rgba(0,0,0,0.04)}
    .headline{display:flex;justify-content:space-between;align-items:center;gap:10px}
    .muted{color:var(--muted);font-size:13px}

    /* Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù„Ø§Ø²Ù… */
    .list{list-style:disc;padding-inline-start:20px;margin:10px 0}
    .pdf-status{font-size:12px;margin-right:8px;color:var(--muted)}

    /* Ø§Ù„Ù…Ø¤Ù‚Øª */
    .timer-display{font-size:44px;font-weight:700;text-align:center;margin:14px 0}
    .controls{display:flex;gap:8px;flex-wrap:wrap;justify-content:center}
    .btn{border:0;padding:8px 12px;border-radius:8px;cursor:pointer;background:var(--primary);color:#fff}
    .btn.ghost{background:#f0f0f0;color:#222}
    input[type="number"]{width:86px;padding:8px;border-radius:6px;border:1px solid #ddd;text-align:center}

    /* responsive */
    @media (max-width:880px){
      .layout{flex-direction:column}
      .side{position:fixed;top:56px;right:0;height:calc(100% - 56px);z-index:90}
      .side.hidden{transform:translateX(110%)}
    }
  </style>
</head>
<body>
  <!-- Ø´Ø±ÙŠØ· Ø¹Ù„ÙˆÙŠ -->
  <header class="topbar">
    <div class="brand">StudyBuddy ğŸ“š</div>
    <div>
      <button id="menuBtn" class="icon-btn" aria-label="Ù‚Ø§Ø¦Ù…Ø©">â˜°</button>
    </div>
  </header>

  <div class="layout">
    <!-- Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© -->
    <aside id="side" class="side hidden" aria-hidden="true">
      <ul>
        <li data-view="home" class="active">ğŸ  Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</li>
        <li data-view="materials">ğŸ“š Ø§Ù„Ù…Ù„Ø§Ø²Ù…</li>
        <li data-view="timer">â± Ø§Ù„Ù…Ø¤Ù‚Øª</li>
        <li data-view="notes">ğŸ“ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª</li>
      </ul>
      <div class="small">StudyBuddy â€” ÙŠØ¹Ù…Ù„ Ø¨Ø¯ÙˆÙ† Ø§ØªØµØ§Ù„</div>
    </aside>

    <!-- Ø§Ù„Ù…Ø­ØªÙˆÙ‰ -->
    <main>
      <!-- Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© -->
      <section id="home" class="card view active">
        <div class="headline">
          <h2>Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ StudyBuddy</h2>
          <div class="muted">Ø§Ø®ØªÙØ± Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø¹Ù„Ù‰ Ø§Ù„ÙŠÙ…ÙŠÙ† Ù„Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ø³Ø±ÙŠØ¹</div>
        </div>
        <p class="muted" style="margin-top:8px">Ø§Ù„Ù†Ø³Ø®Ø© ØªØ¹Ù…Ù„ Ù…Ø­Ù„ÙŠØ§Ù‹ â€” Ø¶Ø¹ Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ù„Ø²Ù…Ø© Ø¯Ø§Ø®Ù„ Ù…Ø¬Ù„Ø¯ <code>pdfs/</code></p>
        <div style="margin-top:12px">
          <button class="btn" onclick="showView('materials')">ğŸ“š Ø§ÙØªØ­ Ø§Ù„Ù…Ù„Ø²Ù…Ø©</button>
          <button class="btn" onclick="showView('timer')">â± Ø§ÙØªØ­ Ø§Ù„Ù…Ø¤Ù‚Øª</button>
          <button class="btn" onclick="showView('notes')">ğŸ“ Ø§ÙØªØ­ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª</button>
        </div>
      </section>

      <!-- Ø§Ù„Ù…Ù„Ø§Ø²Ù… -->
      <section id="materials" class="card view" style="display:none">
        <div class="headline"><h2>Ø§Ù„Ù…Ù„Ø§Ø²Ù… ÙˆØ§Ù„Ù…ÙˆØ§Ø¯</h2><div class="muted">Ø§Ø¶ØºØ· Ù„ÙØªØ­ Ø§Ù„Ù…Ù„Ù (ÙŠÙØªØ­ Ø¨ØªØ¨ÙˆÙŠØ¨ Ø¬Ø¯ÙŠØ¯)</div></div>

        <p class="muted" style="margin-top:8px">ÙØ­Øµ ØªÙ„Ù‚Ø§Ø¦ÙŠ: Ø³ÙŠØ¹Ø±Ø¶ Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ù„Ù (Ù…ØªØ§Ø­ Ø£Ùˆ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯).</p>

        <ul id="pdfList" class="list" style="margin-top:12px">
          <!-- Ø±ÙˆØ§Ø¨Ø· Ø§Ù„Ù…Ù„Ø§Ø²Ù…: ØªØ£ÙƒØ¯ ØªØ¶Ø¹ Ø§Ù„Ù…Ù„ÙØ§Øª Ø¯Ø§Ø®Ù„ Ù…Ø¬Ù„Ø¯ pdfs/ Ø¨Ù†ÙØ³ Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ -->
          <li>
            <span class="pdf-status" data-file="pdfs/math.pdf">â€¦</span>
            <a href="pdfs/math.pdf" class="pdf-link" data-path="pdfs/math.pdf" target="_blank" rel="noopener">Ù…Ù„Ø²Ù…Ø© Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª</a>
          </li>
          <li>
            <span class="pdf-status" data-file="pdfs/physics.pdf">â€¦</span>
            <a href="pdfs/physics.pdf" class="pdf-link" data-path="pdfs/physics.pdf" target="_blank" rel="noopener">Ù…Ù„Ø²Ù…Ø© Ø§Ù„ÙÙŠØ²ÙŠØ§Ø¡</a>
          </li>
          <li>
            <span class="pdf-status" data-file="pdfs/chemistry.pdf">â€¦</span>
            <a href="pdfs/chemistry.pdf" class="pdf-link" data-path="pdfs/chemistry.pdf" target="_blank" rel="noopener">Ù…Ù„Ø²Ù…Ø© Ø§Ù„ÙƒÙŠÙ…ÙŠØ§Ø¡</a>
          </li>
          <li>
            <span class="pdf-status" data-file="pdfs/arabic1.pdf">â€¦</span>
            <a href="pdfs/arabic1.pdf" class="pdf-link" data-path="pdfs/arabic1.pdf" target="_blank" rel="noopener">Ù…Ù„Ø²Ù…Ø© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© (Ø¬Ø²Ø¡ 1)</a>
          </li>
          <li>
            <span class="pdf-status" data-file="pdfs/arabic2.pdf">â€¦</span>
            <a href="pdfs/arabic2.pdf" class="pdf-link" data-path="pdfs/arabic2.pdf" target="_blank" rel="noopener">Ù…Ù„Ø²Ù…Ø© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© (Ø¬Ø²Ø¡ 2)</a>
          </li>
          <li>
            <span class="pdf-status" data-file="pdfs/english.pdf">â€¦</span>
            <a href="pdfs/english.pdf" class="pdf-link" data-path="pdfs/english.pdf" target="_blank" rel="noopener">Ù…Ù„Ø²Ù…Ø© Ø§Ù„Ø§Ù†ÙƒÙ„ÙŠØ²ÙŠ</a>
          </li>
          <li>
            <span class="pdf-status" data-file="pdfs/islamic.pdf">â€¦</span>
            <a href="pdfs/islamic.pdf" class="pdf-link" data-path="pdfs/islamic.pdf" target="_blank" rel="noopener">Ù…Ù„Ø²Ù…Ø© Ø§Ù„Ø§Ø³Ù„Ø§Ù…ÙŠØ©</a>
          </li>
          <li>
            <span class="pdf-status" data-file="pdfs/biology.pdf">â€¦</span>
            <a href="pdfs/biology.pdf" class="pdf-link" data-path="pdfs/biology.pdf" target="_blank" rel="noopener">Ù…Ù„Ø²Ù…Ø© Ø§Ù„Ø§Ø­ÙŠØ§Ø¡</a>
          </li>
          <li>
            <span class="pdf-status" data-file="pdfs/social.pdf">â€¦</span>
            <a href="pdfs/social.pdf" class="pdf-link" data-path="pdfs/social.pdf" target="_blank" rel="noopener">Ù…Ù„Ø²Ù…Ø© Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠØ§Øª</a>
          </li>
        </ul>

        <div class="muted" style="margin-top:10px">Ù…Ù„Ø§Ø­Ø¸Ø©: Ø¥Ø°Ø§ Ø¸Ù‡Ø±Øª Ø¹Ù„Ø§Ù…Ø© âš ï¸ ÙÙ‡Ø°Ø§ ÙŠØ¹Ù†ÙŠ Ø£Ù† Ø§Ù„Ù…Ù„Ù ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ Ø§Ù„Ù…Ø³Ø§Ø± Ø§Ù„Ù…Ø°ÙƒÙˆØ± â€” ØªØ£ÙƒØ¯ ØªØ±ÙØ¹ Ù…Ù„ÙØ§Øª pdf Ø¥Ù„Ù‰ Ù…Ø¬Ù„Ø¯ <code>pdfs/</code>.</div>
      </section>

      <!-- Ø§Ù„Ù…Ø¤Ù‚Øª -->
      <section id="timer" class="card view" style="display:none">
        <div class="headline"><h2>Ù…Ø¤Ù‚Øª Ø¨ÙˆÙ…ÙˆØ¯ÙˆØ±Ùˆ</h2><div class="muted">Ø§Ø¶Ø¨Ø· Ù…Ø¯Ø© Ø§Ù„Ø¬Ù„Ø³Ø© Ø£Ùˆ Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø£Ø²Ø±Ø§Ø±</div></div>

        <div class="timer-display" id="timerDisplay">25:00</div>

        <div class="controls" style="margin-top:8px">
          <button class="btn" id="startTimer">Ø§Ø¨Ø¯Ø£</button>
          <button class="btn ghost" id="pauseTimer">Ø¥ÙŠÙ‚Ø§Ù</button>
          <button class="btn ghost" id="resetTimer">Ø¥Ø¹Ø§Ø¯Ø©</button>
        </div>

        <div class="controls" style="margin-top:12px">
          <button class="btn ghost" id="incMinute">â• Ø¯Ù‚ÙŠÙ‚Ø©</button>
          <button class="btn ghost" id="decMinute">â– Ø¯Ù‚ÙŠÙ‚Ø©</button>
          <label style="display:flex;align-items:center;gap:8px;margin-left:8px"><span class="muted">Ù…Ø¯Ø© (Ø¯Ù‚Ø§Ø¦Ù‚)</span>
            <input id="sessionMinutes" type="number" min="1" value="25" />
          </label>
          <button class="btn" id="setSession">ØªØ¹ÙŠÙŠÙ†</button>
        </div>
      </section>

      <!-- Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª -->
      <section id="notes" class="card view" style="display:none">
        <div class="headline"><h2>Ù…Ù„Ø§Ø­Ø¸Ø§Øª</h2><div class="muted">ØªÙØ­ÙØ¸ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ ÙÙŠ Ù…ØªØµÙØ­Ùƒ</div></div>
        <textarea id="noteText" placeholder="Ø§ÙƒØªØ¨ Ù…Ù„Ø§Ø­Ø¸ØªÙƒ Ù‡Ù†Ø§..." style="margin-top:10px"></textarea>
        <div style="margin-top:8px">
          <button class="btn" id="saveNote">Ø­ÙØ¸</button>
          <button class="btn ghost" id="clearNotes">Ù…Ø³Ø­ Ø§Ù„ÙƒÙ„</button>
        </div>
        <div id="notesList" style="margin-top:12px"></div>
      </section>
    </main>
  </div>

  <footer style="text-align:center;padding:12px;color:var(--muted)">ØªÙ… Ø§Ù„ØªØ·ÙˆÙŠØ± Ø¨ÙˆØ§Ø³Ø·Ø© StudyBuddy â€” 2025</footer>

  <!-- ØµÙˆØª Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡ -->
  <audio id="alarm" preload="auto">
    <source src="https://actions.google.com/sounds/v1/alarms/alarm_clock.ogg" type="audio/ogg">
  </audio>

  <script>
    /**************************************************************************
     * App JS â€” Ø¯Ù‚Ù‚Øª ÙƒÙ„ Ø³Ø·Ø±ØŒ Ø§Ù„ØªÙ†Ù‚Ù„ Ø³Ø±ÙŠØ¹ Ø¬Ø¯Ø§Ù‹ØŒ ÙˆÙØ­Øµ Ø§Ù„Ù…Ù„ÙØ§Øª ÙŠØ­Ø§ÙˆÙ„ Ø§Ù„ØªØ­Ù‚Ù‚ Ù‚Ø¨Ù„ Ø§Ù„ÙØªØ­
     **************************************************************************/

    // ---------------------------
    // Ø¹Ù†Ø§ØµØ± ÙˆØ§Ø¬Ù‡Ø©
    // ---------------------------
    const menuBtn = document.getElementById('menuBtn');
    const side = document.getElementById('side');
    const navItems = side.querySelectorAll('li[data-view]');
    const views = document.querySelectorAll('.view');

    // Ø§Ù„Ù…Ù„Ø§Ø²Ù…: Ø¹Ù†Ø§ØµØ± Ø®Ø§ØµØ© Ø¨Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© ÙˆØ§Ù„Ø±ÙˆØ§Ø¨Ø·
    const pdfLinks = Array.from(document.querySelectorAll('.pdf-link'));
    const pdfStatusSpans = Array.from(document.querySelectorAll('.pdf-status'));

    // Ø§Ù„Ù…Ø¤Ù‚Øª
    const timerDisplay = document.getElementById('timerDisplay');
    const startBtn = document.getElementById('startTimer');
    const pauseBtn = document.getElementById('pauseTimer');
    const resetBtn = document.getElementById('resetTimer');
    const incMinuteBtn = document.getElementById('incMinute');
    const decMinuteBtn = document.getElementById('decMinute');
    const sessionMinutes = document.getElementById('sessionMinutes');
    const setSessionBtn = document.getElementById('setSession');
    const alarm = document.getElementById('alarm');

    // Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª
    const noteText = document.getElementById('noteText');
    const saveNoteBtn = document.getElementById('saveNote');
    const clearNotesBtn = document.getElementById('clearNotes');
    const notesListDiv = document.getElementById('notesList');

    // Ø­Ø§Ù„Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
    let timerInterval = null;
    let timerSeconds = parseInt(sessionMinutes.value || 25) * 60;
    let isRunning = false;

    // ---------------------------
    // Ù…Ø³Ø§Ø¹Ø¯Ø§Øª Ø§Ù„Ø¹Ø±Ø¶ ÙˆØ§Ù„ØªÙ†Ù‚Ù„
    // ---------------------------
    function showView(id) {
      views.forEach(v => {
        if (v.id === id) {
          v.style.display = '';
        } else {
          v.style.display = 'none';
        }
      });
      // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„ØµØºÙŠØ±Ø© Ù„ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø³Ø±Ø¹Ø©
      if (window.innerWidth < 880) side.classList.add('hidden');
      // ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¹Ù†ØµØ± Ø§Ù„Ù†Ø´Ø· ÙÙŠ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
      navItems.forEach(it => it.classList.toggle('active', it.dataset.view === id));
    }

    // Ø±Ø¨Ø· Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªÙ†Ù‚Ù„ (Ø³Ø±ÙŠØ¹)
    menuBtn.addEventListener('click', () => side.classList.toggle('hidden'));
    navItems.forEach(li => {
      li.addEventListener('click', () => {
        const v = li.dataset.view;
        showView(v);
      });
    });

    // expose for buttons
    window.showView = showView;

    // ---------------------------
    // ÙØ­Øµ Ø­Ø§Ù„Ø© Ù…Ù„ÙØ§Øª PDF (HEAD) ÙˆÙˆØ¶Ø¹ Ø¹Ù„Ø§Ù…Ø© Ø­Ø§Ù„Ø©
    // - Ù†Ø­Ø§ÙˆÙ„ HEAD Ù„ÙƒÙ„ Ù…Ù„Ù. Ù„Ùˆ Ø§Ø³ØªØ¬Ø§Ø¨Ø© ok => Ù†Ø¹Ù„Ù‘Ù… Ù…ØªØ§Ø­ âœ…
    // - Ù„Ùˆ ÙØ´Ù„ => Ù†Ø¹Ø±Ø¶ âš ï¸ (Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙŠØ¹Ø±Ù ÙŠØ±ÙØ¹ Ø§Ù„Ù…Ù„Ù)
    // ---------------------------
    async function checkFileExists(url) {
      try {
        // Ø·Ù„Ø¨ Ù…Ù† Ù†ÙˆØ¹ HEAD Ø£Ø³Ø±Ø¹ ÙˆØ£Ù‚Ù„ ØªØ­Ù…ÙŠÙ„Ù‹Ø§
        const res = await fetch(url, { method: 'HEAD' });
        return res && res.ok;
      } catch (e) {
        // Ù‚Ø¯ ØªÙØ´Ù„ Ø¨Ø³Ø¨Ø¨ CORS Ø£Ùˆ Ù‚ÙŠÙˆØ¯ Ø§Ù„Ø®Ø§Ø¯Ù… â€” Ø§Ø¹ØªØ¨Ø±Ù‡ ØºÙŠØ± Ù…ØªØ§Ø­ Ù„ÙƒÙ† Ù„Ø§ ØªÙ‚ØªÙ„ Ø§Ù„ØªØ¬Ø±Ø¨Ø©
        return false;
      }
    }

    async function scanPDFsAndMark() {
      // Ù†ÙÙ‘Ø° Ø§Ù„ÙØ­Øµ Ù„ÙƒÙ† Ù„Ø§ Ù†Ù…Ù†Ø¹ ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… â€” Ù†Ø¹Ù…Ù„Ù‡ Ø¨Ø§Ù„ØªÙˆØ§Ø²ÙŠ
      pdfStatusSpans.forEach(sp => sp.textContent = 'Ø¬Ø§Ø±Ù Ø§Ù„ÙØ­Øµâ€¦');
      await Promise.all(pdfStatusSpans.map(async (sp) => {
        const file = sp.dataset.file;
        const ok = await checkFileExists(file);
        sp.textContent = ok ? 'âœ… Ù…ØªØ§Ø­' : 'âš ï¸ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯';
        sp.style.color = ok ? 'green' : '#d16a3a';
      }));
    }

    // ---------------------------
    // Ù…Ø¹Ø§Ù„Ø¬Ø© Ù†Ù‚Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¹Ù„Ù‰ Ø±ÙˆØ§Ø¨Ø· PDF
    // - Ù†Ù…Ù†Ø¹ Ø§Ù„Ø³Ù„ÙˆÙƒ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ
    // - Ù†ØªØ­Ù‚Ù‚ HEAD Ù‚Ø¨Ù„ Ø§Ù„ÙØªØ­ØŒ ÙˆØ¥Ø°Ø§ ØºÙŠØ± Ù…ØªØ§Ø­ Ù†Ø¹Ù„Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
    // ---------------------------
    pdfLinks.forEach(link => {
      link.addEventListener('click', async (ev) => {
        ev.preventDefault();
        const path = link.dataset.path;
        // ÙØ­Øµ Ø³Ø±ÙŠØ¹
        const exists = await checkFileExists(path);
        if (exists) {
          window.open(path, '_blank');
        } else {
          const openAnyway = confirm('Ø§Ù„Ù…Ù„Ù ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯ Ø£Ùˆ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„ÙŠÙ‡ ÙÙŠ Ø§Ù„Ù…Ø³Ø§Ø±:\n' + path + '\n\nØªØ£ÙƒØ¯ Ø£Ù†Ùƒ Ø±ÙØ¹Øª Ø§Ù„Ù…Ù„Ù Ø¯Ø§Ø®Ù„ Ù…Ø¬Ù„Ø¯ pdfs/ Ø¨Ù†ÙØ³ Ø§Ù„Ø§Ø³Ù….\nÙ‡Ù„ ØªÙØªØ­ Ø§Ù„Ø±Ø§Ø¨Ø· ÙÙŠ ØªØ¨ÙˆÙŠØ¨ Ø¬Ø¯ÙŠØ¯ Ø¹Ù„Ù‰ Ø£ÙŠ Ø­Ø§Ù„ØŸ');
          if (openAnyway) window.open(path, '_blank');
        }
      });
    });

    // ---------------------------
    // Ù…Ø¤Ù‚Øª â€” ÙˆØ¸Ø§Ø¦Ù
    // ---------------------------
    function updateTimerDisplay() {
      const m = Math.floor(timerSeconds / 60).toString().padStart(2, '0');
      const s = (timerSeconds % 60).toString().padStart(2, '0');
      timerDisplay.textContent = `${m}:${s}`;
    }

    function startTimer() {
      if (isRunning) return;
      isRunning = true;
      // ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø¬Ù„Ø³Ø© Ø¨Ø­Ø³Ø¨ Ø§Ù„Ø­Ù‚Ù„ Ø¥Ø°Ø§ ØªØºÙŠØ±
      const minutes = Math.max(1, parseInt(sessionMinutes.value || 25));
      if (!timerInterval) {
        // Ø¥Ø°Ø§ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø­Ø§Ù„ÙŠ Ø£ÙƒØ¨Ø± Ù…Ù† ØµÙØ± Ù†ØªØ§Ø¨Ø¹ØŒ ÙˆØ¥Ù„Ø§ Ù†Ø¹ÙŠØ¯ Ø§Ù„ØªØ¹ÙŠÙŠÙ†
        if (timerSeconds <= 0) timerSeconds = minutes * 60;
        timerInterval = setInterval(() => {
          if (timerSeconds > 0) {
            timerSeconds--;
            updateTimerDisplay();
          } else {
            stopTimer();
            // ØªØ´ØºÙŠÙ„ ØµÙˆØª ÙˆØªÙ†Ø¨ÙŠÙ‡
            try { alarm.currentTime = 0; alarm.play().catch(()=>{}); } catch(e){}
            alert('â° Ø§Ù†ØªÙ‡Øª Ù…Ø¯Ø© Ø§Ù„Ø¬Ù„Ø³Ø©');
          }
        }, 1000);
      }
    }

    function stopTimer() {
      clearInterval(timerInterval);
      timerInterval = null;
      isRunning = false;
    }

    function pauseTimer() {
      stopTimer();
    }

    function resetTimer() {
      stopTimer();
      timerSeconds = Math.max(1, parseInt(sessionMinutes.value || 25)) * 60;
      updateTimerDisplay();
    }

    function incMinute() {
      timerSeconds += 60;
      updateTimerDisplay();
    }

    function decMinute() {
      if (timerSeconds > 60) {
        timerSeconds -= 60;
        updateTimerDisplay();
      }
    }

    function setSession() {
      const m = Math.max(1, parseInt(sessionMinutes.value || 25));
      timerSeconds = m * 60;
      updateTimerDisplay();
    }

    // Ø±Ø¨Ø· Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ù…Ø¤Ù‚Øª
    startBtn.addEventListener('click', startTimer);
    pauseBtn.addEventListener('click', pauseTimer);
    resetBtn.addEventListener('click', resetTimer);
    incMinuteBtn.addEventListener('click', incMinute);
    decMinuteBtn.addEventListener('click', decMinute);
    setSessionBtn.addEventListener('click', setSession);

    // ---------------------------
    // Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª (localStorage)
    // ---------------------------
    const NOTES_KEY = 'studybuddy_notes_v1';

    function loadNotes() {
      try {
        const raw = localStorage.getItem(NOTES_KEY);
        if (!raw) return;
        const arr = JSON.parse(raw);
        renderNotes(arr);
      } catch(e){}
    }

    function saveNotesArray(arr) {
      try { localStorage.setItem(NOTES_KEY, JSON.stringify(arr)); } catch(e){}
    }

    function renderNotes(list) {
      notesListDiv.innerHTML = '';
      if (!list || list.length === 0) {
        notesListDiv.innerHTML = '<div class="muted">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù„Ø§Ø­Ø¸Ø§Øª</div>';
        return;
      }
      // Ø¹Ø±Ø¶ Ø£Ø­Ø¯Ø« Ø£ÙˆÙ„Ø§Ù‹
      list.slice().reverse().forEach(n => {
        const el = document.createElement('div');
        el.style.padding = '8px';
        el.style.marginBottom = '8px';
        el.style.borderRadius = '6px';
        el.style.background = '#fff';
        el.style.boxShadow = '0 1px 4px rgba(0,0,0,0.04)';
        el.innerHTML = `<div style="font-size:14px">${escapeHtml(n.text)}</div><div class="muted" style="font-size:12px;margin-top:6px">${new Date(n.created).toLocaleString()}</div>`;
        notesListDiv.appendChild(el);
      });
    }

    function escapeHtml(s){ if(!s) return ''; return String(s).replace(/[&<>"']/g, c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c])); }

    saveNoteBtn.addEventListener('click', () => {
      const text = (noteText.value || '').trim();
      if (!text) { alert('Ø§ÙƒØªØ¨ Ù†Øµ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø©'); return; }
      let arr = [];
      try { arr = JSON.parse(localStorage.getItem(NOTES_KEY) || '[]'); } catch(e){ arr = []; }
      arr.push({ id: 'n-'+Date.now(), text, created: Date.now() });
      saveNotesArray(arr);
      noteText.value = '';
      renderNotes(arr);
      alert('âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø©');
    });

    clearNotesBtn.addEventListener('click', () => {
      if (!confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ù…Ø³Ø­ ÙƒÙ„ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§ØªØŸ')) return;
      localStorage.removeItem(NOTES_KEY);
      renderNotes([]);
    });

    // ---------------------------
    // ØªÙ‡ÙŠØ¦Ø© Ø£ÙˆÙ„ÙŠØ© Ø¹Ù†Ø¯ ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
    // ---------------------------
    function init() {
      // ØªØ¹ÙŠÙŠÙ† Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø¤Ù‚Øª Ù…Ù† Ø§Ù„Ø­Ù‚Ù„
      timerSeconds = Math.max(1, parseInt(sessionMinutes.value || 25)) * 60;
      updateTimerDisplay();
      // Ø´ØºÙ‘Ù„ ÙØ­Øµ Ø§Ù„Ù…Ù„Ø§Ø²Ù… Ø¨Ø§Ù„Ø®Ù„ÙÙŠØ© (Ø³ÙŠÙƒØ´Ù Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ù„ÙØ§Øª Ø¥Ù† Ø£Ù…ÙƒÙ†)
      scanPDFsAndMark();
      // Ø±ÙÙØ¹ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ù…Ù† Ø§Ù„ØªØ®Ø²ÙŠÙ†
      loadNotes();
      // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„ØµØºÙŠØ±Ø© Ù…Ø¨Ø¯Ø¦ÙŠØ§Ù‹
      if (window.innerWidth < 880) side.classList.add('hidden');
    }

    // Ù†ÙÙ‘Ø° init Ø¨Ø¹Ø¯ ØªØ­Ù…ÙŠÙ„ DOM
    document.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>
